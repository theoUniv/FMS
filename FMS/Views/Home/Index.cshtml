@* Vue Razor - Index.cshtml *@
<h2>Bienvenue dans l'application MVC</h2>

<!-- Formulaire pour ajouter un utilisateur -->
<div class="container mt-4">
    <h3>Ajouter un utilisateur</h3>

    <form id="addUserForm" class="needs-validation" novalidate>
        <!-- Champ pour le nom d'utilisateur -->
        <div class="mb-3">
            <label for="username" class="form-label">Nom d'utilisateur</label>
            <input type="text" class="form-control" id="username" name="username" required>
            <div class="invalid-feedback">
                Veuillez entrer un nom d'utilisateur.
            </div>
        </div>

        <!-- Champ pour le mot de passe -->
        <div class="mb-3">
            <label for="password" class="form-label">Mot de passe</label>
            <input type="password" class="form-control" id="password" name="password" required>
            <div class="invalid-feedback">
                Veuillez entrer un mot de passe.
            </div>
        </div>

        <!-- Bouton de soumission -->
        <button type="submit" class="btn btn-primary">Ajouter l'utilisateur</button>
    </form>

    <!-- Message de réponse -->
    <div id="responseMessage" class="mt-3"></div>
</div>

<!-- Script Bootstrap et validation personnalisée -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

<script>
    $(document).ready(function () {
        // Lors de la soumission du formulaire
        $('#addUserForm').on('submit', function (e) {
            e.preventDefault(); // Empêcher la soumission classique du formulaire

            // Valider le formulaire avec Bootstrap (validation Bootstrap)
            if (!this.checkValidity()) {
                e.stopPropagation();
                this.classList.add('was-validated');
                return;
            }

            // Récupérer les données du formulaire
            var userData = {
                username: $('#username').val(),
                password: $('#password').val()
            };

            // Effectuer un appel AJAX pour ajouter l'utilisateur
            $.ajax({
                url: '@Url.Action("AddUser", "SQL")', // URL vers l'action AddUser du contrôleur SQL
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(userData), // Convertir les données en JSON
                success: function (response) {
                    // Afficher un message de succès
                    $('#responseMessage').html('<div class="alert alert-success">' + Utilisateur ajouté avec succès + '</div>');
                    // Réinitialiser le formulaire
                    $('#addUserForm')[0].reset();
                    $('#addUserForm').removeClass('was-validated');
                },
                error: function (xhr, status, error) {
                    // Gérer l'erreur
                    $('#responseMessage').html('<div class="alert alert-danger">Erreur lors de l\'ajout de l\'utilisateur.</div>');
                }
            });
        });
    });
</script>
